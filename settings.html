<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Settings - TabTalk Recorder</title>
    <link rel="stylesheet" href="fontawesome/css/all.min.css">
    <link rel="stylesheet" href="settings.css">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-cog"></i> Settings</h1>
        <p class="subtitle">Configure your audio recorder preferences</p>
      </div>

      <!-- Transcription Settings -->
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-language"></i>
          <h2>Transcription</h2>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="apiKey">Google Gemini API Key</label>
            <p class="setting-description">
              Get your free API key from
              <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>
              <br>
              <small>Free tier: 15 requests/min, 1500 requests/day</small>
            </p>
          </div>
          <div class="setting-control">
            <div class="api-key-input">
              <input
                type="password"
                id="apiKey"
                placeholder="AIza..."
                autocomplete="off"
              >
              <button id="toggleApiKey" class="icon-button" title="Show/Hide">
                <i class="fas fa-eye"></i>
              </button>
            </div>
            <div class="button-group">
              <button id="saveApiKey" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Key
              </button>
              <button id="clearApiKey" class="btn btn-secondary">
                <i class="fas fa-trash"></i> Clear
              </button>
              <button id="testApiKey" class="btn btn-secondary">
                <i class="fas fa-vial"></i> Test
              </button>
            </div>
            <div id="apiKeyStatus" class="status-message"></div>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="modelSelect">Transcription Model</label>
            <p class="setting-description">
              Choose the AI model for transcription
            </p>
          </div>
          <div class="setting-control">
            <select id="modelSelect" class="select-input">
              <option value="gemini-2.5-flash">Gemini 2.5 Flash - Balanced</option>
              <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash-Lite - Fastest</option>
              <option value="gemini-2.5-pro">Gemini 2.5 Pro - Most Accurate</option>
            </select>
            <div class="model-info">
              <div id="modelDescription" class="model-description"></div>
            </div>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="autoTranscribe">Auto Transcribe</label>
            <p class="setting-description">
              Automatically transcribe recordings after they're saved
            </p>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="autoTranscribe">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="transcriptionChunkIntervalSeconds">Transcription Chunk Interval (seconds)</label>
            <p class="setting-description">
              Split long recordings into segments for Gemini transcription (lower values reduce token limit issues)
            </p>
          </div>
          <div class="setting-control">
            <input type="number" id="transcriptionChunkIntervalSeconds" min="15" max="600" step="5" value="60">
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="geminiTranscriptionMaxOutputTokens">Gemini Transcription Max Output Tokens</label>
            <p class="setting-description">
              Increase only if transcriptions are being truncated by the model
            </p>
          </div>
          <div class="setting-control">
            <input type="number" id="geminiTranscriptionMaxOutputTokens" min="1024" max="65536" step="256" value="16384">
          </div>
        </div>
      </div>

      <!-- Audio Settings -->
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-volume-up"></i>
          <h2>Audio</h2>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="tabGain">Tab Audio Volume</label>
            <p class="setting-description">
              Adjust the volume of audio from browser tabs
            </p>
          </div>
          <div class="setting-control">
            <div class="slider-container">
              <input type="range" id="tabGain" min="0" max="2" step="0.1" value="1.0">
              <span id="tabGainValue" class="slider-value">1.0x</span>
            </div>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="micGain">Microphone Volume</label>
            <p class="setting-description">
              Adjust the volume of your microphone input
            </p>
          </div>
          <div class="setting-control">
            <div class="slider-container">
              <input type="range" id="micGain" min="0" max="3" step="0.1" value="1.5">
              <span id="micGainValue" class="slider-value">1.5x</span>
            </div>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="enableMicrophoneCapture">Enable Microphone Capture</label>
            <p class="setting-description">
              Enable to record both tab audio and microphone input
            </p>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="enableMicrophoneCapture">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="audioQuality">Recording Quality</label>
            <p class="setting-description">
              Higher quality = better audio, larger file size
            </p>
          </div>
          <div class="setting-control">
            <select id="audioQuality" class="select-input">
              <option value="16000">Very Low (16 kHz) - Smallest files</option>
              <option value="22050">Low (22 kHz)</option>
              <option value="32000">Medium (32 kHz)</option>
              <option value="44100">High (44.1 kHz) - CD Quality</option>
              <option value="48000">Very High (48 kHz) - Studio Quality</option>
            </select>
            <div class="quality-info" style="margin-top: 8px; font-size: 12px; color: #666;">
              <div id="qualityDescription"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Storage Settings -->
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-database"></i>
          <h2>Storage</h2>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="maxRecordings">Maximum Recordings</label>
            <p class="setting-description">
              Automatically delete oldest recordings when limit is reached
            </p>
          </div>
          <div class="setting-control">
            <input type="number" id="maxRecordings" min="5" max="100" value="50">
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label>Clear All Data</label>
            <p class="setting-description">
              Delete all recordings and reset settings
            </p>
          </div>
          <div class="setting-control">
            <button id="clearAllData" class="btn btn-danger">
              <i class="fas fa-exclamation-triangle"></i> Clear All Data
            </button>
          </div>
        </div>
      </div>

      <!-- Custom Prompts Settings -->
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-magic"></i>
          <h2>AI Post-Processing Prompts</h2>
        </div>
        <p class="setting-description" style="margin-bottom: 15px;">
          Manage custom system prompts for processing transcriptions with AI. Built-in prompts are provided, and you can add your own custom prompts.
        </p>

        <!-- Built-in Prompts List -->
        <div class="setting-item">
          <div class="setting-label">
            <label>Built-in Prompts</label>
            <p class="setting-description">
              Pre-configured prompts for common tasks
            </p>
          </div>
          <div class="setting-control">
            <div id="builtinPromptsList" class="prompts-list"></div>
          </div>
        </div>

        <!-- Custom Prompts List -->
        <div class="setting-item">
          <div class="setting-label">
            <label>Custom Prompts</label>
            <p class="setting-description">
              Your custom prompts
            </p>
          </div>
          <div class="setting-control">
            <div id="customPromptsList" class="prompts-list"></div>
            <button id="addCustomPrompt" class="btn btn-primary" style="margin-top: 10px;">
              <i class="fas fa-plus"></i> Add Custom Prompt
            </button>
          </div>
        </div>

        <!-- Prompt Import/Export -->
        <div class="setting-item">
          <div class="setting-label">
            <label>Import/Export Prompts</label>
            <p class="setting-description">
              Share your custom prompts
            </p>
          </div>
          <div class="setting-control">
            <div class="button-group">
              <button id="exportPrompts" class="btn btn-secondary">
                <i class="fas fa-download"></i> Export Custom Prompts
              </button>
              <button id="importPrompts" class="btn btn-secondary">
                <i class="fas fa-upload"></i> Import Prompts
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- UI Settings -->
      <div class="settings-section">
        <div class="section-header">
          <i class="fas fa-palette"></i>
          <h2>Interface</h2>
        </div>

        <div class="setting-item">
          <div class="setting-label">
            <label for="showNotifications">Show Notifications</label>
            <p class="setting-description">
              Display success and error notifications
            </p>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="showNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="settings-actions">
        <button id="saveSettings" class="btn btn-primary btn-large">
          <i class="fas fa-save"></i> Save All Settings
        </button>
        <button id="resetSettings" class="btn btn-secondary">
          <i class="fas fa-undo"></i> Reset to Defaults
        </button>
        <button id="exportSettings" class="btn btn-secondary">
          <i class="fas fa-download"></i> Export Settings
        </button>
        <button id="importSettings" class="btn btn-secondary">
          <i class="fas fa-upload"></i> Import Settings
        </button>
      </div>

      <!-- Footer -->
      <div class="settings-footer">
        <p>
          <button id="openHistory" class="link-button">View History</button>
        </p>
        <p class="version">Version 2.0.0</p>
      </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFile" accept=".json" style="display: none;">
    <input type="file" id="importPromptsFile" accept=".json" style="display: none;">

    <!-- Custom Prompt Modal -->
    <div id="promptModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="promptModalTitle">Add Custom Prompt</h2>
          <button class="modal-close" id="closePromptModal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="promptName">Prompt Name *</label>
            <input type="text" id="promptName" placeholder="e.g., Meeting Summary" required>
          </div>
          <div class="form-group">
            <label for="promptCategory">Category</label>
            <input type="text" id="promptCategory" placeholder="e.g., Business, Productivity">
          </div>
          <div class="form-group">
            <label for="promptDescription">Description</label>
            <textarea id="promptDescription" rows="2" placeholder="Brief description of what this prompt does"></textarea>
          </div>
          <div class="form-group">
            <label for="promptText">System Prompt *</label>
            <textarea id="promptText" rows="10" placeholder="Enter your system prompt here. Use {{TRANSCRIPTION}} as placeholder for the transcription text." required></textarea>
            <p class="form-hint">Use <code>{{TRANSCRIPTION}}</code> as a placeholder where the transcription should be inserted.</p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="savePrompt" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Prompt
          </button>
          <button id="cancelPrompt" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <script src="utils/constants.js"></script>
    <script src="utils/config.js"></script>
    <script type="module" src="utils/indexeddb.js"></script>
    <script type="module" src="utils/storage.js"></script>
    <script type="module" src="utils/prompts.js"></script>
    <script src="utils/formatters.js"></script>
    <script src="settings.js"></script>
  </body>
</html>
